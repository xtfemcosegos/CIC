<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Espacio | CIC 6.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --emerald-primary: #059669; 
            --emerald-dark: #064e3b;
            --emerald-bg: #f0fdf4; 
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--emerald-bg); 
            margin: 0; 
            overflow: hidden; 
        }
        .tab-btn { 
            flex: 1; 
            padding: 16px; 
            font-size: 10px; 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 0.15em; 
            color: #94a3b8; 
            border-bottom: 3px solid transparent; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .tab-btn.active { 
            color: var(--emerald-primary); 
            border-bottom-color: var(--emerald-primary); 
            background: rgba(16, 185, 129, 0.05);
        }
        iframe { 
            width: 100%; 
            height: calc(100vh - 135px); 
            border: none; 
            background: transparent; 
        }
        .input-standard { 
            width: 100%; 
            background: #f8fafc; 
            border: 2px solid transparent; 
            border-radius: 20px; 
            padding: 14px 20px; 
            font-size: 14px; 
            font-weight: 600; 
            outline: none; 
            transition: all 0.2s; 
        }
        .input-standard:focus { 
            border-color: var(--emerald-primary); 
            background: white; 
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }
        .metallic-header {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            box-shadow: 0 4px 20px rgba(6, 78, 59, 0.2);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- PANTALLA DE ACCESO (LOGIN) -->
    <div id="login-view" class="fixed inset-0 flex items-center justify-center p-6 bg-[#f0fdf4] z-[9999]">
        <div class="bg-white rounded-[40px] w-full max-w-md p-10 shadow-2xl border border-emerald-100 flex flex-col items-center">
            <div class="w-20 h-20 bg-emerald-50 rounded-[30px] flex items-center justify-center mb-8 border border-emerald-100">
                <i class="fa-solid fa-user-shield text-3xl text-emerald-700"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tighter">Mi Espacio</h2>
            <p class="text-[10px] font-black text-emerald-600/60 uppercase tracking-[0.3em] mb-10 text-center">Portal del Colaborador CIC 6.2</p>
            
            <div class="w-full space-y-4">
                <div class="space-y-1">
                    <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-4">Identificación</label>
                    <input type="email" id="login-email" class="input-standard" placeholder="usuario@cic.com">
                </div>
                <div class="space-y-1">
                    <label class="text-[9px] font-black uppercase tracking-widest text-slate-400 ml-4">Clave de Seguridad</label>
                    <input type="password" id="login-pass" class="input-standard" placeholder="••••••••">
                </div>
                <button onclick="handleLogin()" id="btn-login" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white rounded-[24px] p-4.5 font-black uppercase text-[11px] tracking-widest mt-6 shadow-lg shadow-emerald-600/20 transition-all active:scale-95">
                    Acceder al Terminal
                </button>
            </div>
            <p class="mt-12 text-[9px] font-black text-slate-300 uppercase tracking-widest">Protección Patrimonial © 2026</p>
        </div>
    </div>

    <!-- ESTRUCTURA DE LA APLICACIÓN -->
    <div id="app-content" class="hidden flex flex-col h-screen">
        <header class="metallic-header text-white p-6 pb-14">
            <div class="max-w-xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <img id="op-avatar" src="" class="w-12 h-12 rounded-2xl object-cover border-2 border-white/20 shadow-xl bg-emerald-800">
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-400 border-2 border-[#064e3b] rounded-full"></div>
                    </div>
                    <div>
                        <p class="text-[9px] font-black text-emerald-200/50 uppercase tracking-widest leading-none mb-1.5">Colaborador Activo</p>
                        <h1 id="op-name" class="text-sm font-black uppercase tracking-tight leading-none">Cargando...</h1>
                    </div>
                </div>
                <button onclick="handleLogout()" class="w-10 h-10 rounded-2xl bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all border border-white/10 shadow-inner">
                    <i class="fa-solid fa-right-from-bracket text-xs text-emerald-100"></i>
                </button>
            </div>
        </header>

        <nav class="max-w-xl mx-auto w-full -mt-8 px-6 z-10">
            <div class="bg-white/90 backdrop-blur-md rounded-[24px] shadow-2xl flex border border-white p-1.5">
                <button onclick="switchTab('perfil')" id="tab-perfil" class="tab-btn rounded-2xl">Perfiles</button>
                <button onclick="switchTab('herramientas')" id="tab-herramientas" class="tab-btn active rounded-2xl">Herramientas</button>
            </div>
        </nav>

        <main class="flex-grow max-w-xl mx-auto w-full overflow-hidden mt-4">
            <iframe id="main-frame" src="" allow="camera; geolocation" class="animate-fade-in"></iframe>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCd4p8USmJeFOie1cJj0Hi80-z8IbLAGqU",
            authDomain: "cic6-pp-web.firebaseapp.com",
            projectId: "cic6-pp-web",
            storageBucket: "cic6-pp-web.firebasestorage.app",
            appId: "1:248659087868:web:a277ef700d83c7f1d22279"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('login-view').style.display = 'none';
                document.getElementById('app-content').classList.remove('hidden');
                
                try {
                    const snap = await getDoc(doc(db, 'artifacts', 'cic.pp', 'public', 'data', 'Usuarios', user.uid));
                    if (snap.exists()) {
                        const data = snap.data();
                        document.getElementById('op-name').innerText = data.nombre || "Usuario CIC";
                        document.getElementById('op-avatar').src = data.foto || `https://ui-avatars.com/api/?background=064e3b&color=fff&name=${encodeURIComponent(data.nombre || 'U')}`;
                    }
                } catch(e) { console.error(e); }
                
                switchTab('herramientas');
            } else {
                document.getElementById('login-view').style.display = 'flex';
                document.getElementById('app-content').classList.add('hidden');
            }
        });

        window.handleLogin = async () => {
            const btn = document.getElementById('btn-login');
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            if(!email || !pass) return;
            btn.disabled = true;
            btn.innerText = "Verificando...";
            try { 
                await signInWithEmailAndPassword(auth, email, pass); 
            } catch (e) { 
                alert("Error de acceso: Credenciales inválidas"); 
                btn.disabled = false;
                btn.innerText = "Acceder al Terminal";
            }
        };

        window.handleLogout = () => { 
            if(confirm("¿Cerrar sesión de terminal?")) signOut(auth); 
        };

        window.switchTab = (tab) => {
            const frame = document.getElementById('main-frame');
            document.getElementById('tab-perfil').classList.toggle('active', tab === 'perfil');
            document.getElementById('tab-herramientas').classList.toggle('active', tab === 'herramientas');
            
            // Efecto suave de cambio
            frame.style.opacity = '0';
            setTimeout(() => {
                frame.src = tab === 'perfil' 
                    ? "Subcomponentes_Elemento/Perfil.html" 
                    : "Subcomponentes_Elemento/Herramientas_Menu.html";
                frame.style.opacity = '1';
            }, 150);
        };
    </script>
</body>
</html>