<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consola de Diagnóstico CCTV AXIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #020617;
            color: white;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }

        .metallic-header {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* --- LAYOUT TRIPLE --- */
        .main-container {
            display: flex;
            height: calc(100vh - 105px);
            width: 100%;
        }

        /* Sidebar Izquierda: Inventario */
        .sidebar-left {
            width: 320px;
            background: rgba(15, 23, 42, 0.95);
            border-right: 1px solid rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
        }

        /* Centro: Monitor */
        .viewport-center {
            flex: 1;
            background: #000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        /* Sidebar Derecha: Consola */
        .sidebar-right {
            width: 350px;
            background: #050505;
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            font-family: 'JetBrains Mono', monospace;
        }

        /* --- COMPONENTES --- */
        .cam-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.02);
            cursor: pointer;
            transition: all 0.2s;
        }
        .cam-item:hover { background: rgba(56, 189, 248, 0.05); }
        .cam-item.active { background: rgba(56, 189, 248, 0.1); border-left: 3px solid #38bdf8; }

        .video-box {
            width: 100%;
            aspect-ratio: 16/9;
            background: #0a0a0a;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .console-line {
            padding: 4px 12px;
            font-size: 11px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            line-height: 1.4;
        }
        .log-info { color: #94a3b8; }
        .log-warn { color: #f59e0b; background: rgba(245, 158, 11, 0.05); }
        .log-error { color: #ef4444; background: rgba(239, 68, 68, 0.05); }
        .log-success { color: #10b981; }

        .search-box {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            width: 100%;
        }

        .btn-action {
            background: #38bdf8;
            color: #020617;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.2s;
        }
        .btn-action:hover { background: #7dd3fc; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <header class="metallic-header h-[65px] flex items-center px-6 justify-between z-50">
        <div class="flex items-center gap-4">
            <div class="p-2 bg-sky-500/10 rounded-lg">
                <svg class="w-6 h-6 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
            </div>
            <div>
                <h1 class="text-sm font-black tracking-widest uppercase">Diagnóstico Pro CCTV Axis</h1>
                <p class="text-[9px] text-slate-400 font-bold uppercase">Consola de Mando y Análisis de Seguridad SSL</p>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-[10px] font-bold text-slate-500">CONEXIÓN EXTERNA:</span>
            <div class="px-3 py-1 bg-blue-500/10 border border-blue-500/20 rounded-full text-[10px] font-bold text-blue-400 uppercase tracking-tighter">HTTPS Enforcement</div>
        </div>
    </header>

    <div class="main-container">
        <!-- IZQUIERDA: LISTADO -->
        <aside class="sidebar-left">
            <div class="p-4 border-b border-white/5">
                <input type="text" id="search-input" class="search-box" placeholder="BUSCAR CÁMARA..." oninput="renderList()">
            </div>
            <div id="list-container" class="flex-1 overflow-y-auto no-scrollbar">
                <!-- Items se cargan aquí -->
            </div>
        </aside>

        <!-- CENTRO: MONITOR -->
        <main class="viewport-center no-scrollbar">
            <div id="active-monitor" class="hidden">
                <div class="video-box mb-6">
                    <div id="loader" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-950/80 z-20 hidden">
                        <div class="w-10 h-10 border-4 border-sky-500/20 border-t-sky-500 rounded-full animate-spin"></div>
                    </div>
                    <img id="main-stream" src="" class="w-full h-full object-contain">
                </div>
                
                <!-- Detalles VAPIX -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                        <span class="text-[9px] font-black text-slate-500 uppercase">Nodo Seleccionado</span>
                        <h2 id="view-name" class="text-xs font-bold text-white mt-1">-</h2>
                        <div id="view-model" class="text-[10px] text-sky-400 font-mono mt-1">-</div>
                    </div>
                    <div class="bg-white/5 p-4 rounded-xl border border-white/5 relative">
                        <span class="text-[9px] font-black text-slate-500 uppercase">Endpoint Seguro</span>
                        <h2 id="view-ip" class="text-xs font-bold text-white mt-1">-</h2>
                        <div class="mt-2 flex gap-2">
                            <button id="btn-fix-ssl" onclick="openCertTab()" class="btn-action hidden">
                                Autorizar Certificado
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Alerta de Seguridad Contextual -->
                <div id="ssl-warning" class="mt-6 p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl hidden">
                    <div class="flex gap-3">
                        <svg class="w-5 h-5 text-amber-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                        <div>
                            <h3 class="text-xs font-bold text-amber-500 uppercase">Advertencia de Seguridad Detectada</h3>
                            <p class="text-[10px] text-slate-400 mt-1 leading-relaxed">
                                El navegador ha bloqueado la conexión por un certificado no válido o auto-firmado. 
                                Haga clic en <strong>Autorizar Certificado</strong>, acepte el riesgo en la nueva pestaña y regrese aquí.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="empty-state" class="flex flex-col items-center justify-center h-full opacity-20">
                <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                <span class="text-xs font-black uppercase tracking-[0.3em]">Esperando Selección</span>
            </div>
        </main>

        <!-- DERECHA: CONSOLA -->
        <aside class="sidebar-right">
            <div class="p-3 bg-white/5 border-b border-white/10 flex justify-between items-center">
                <span class="text-[10px] font-bold text-sky-400 tracking-widest">DIAGNÓSTICO TÉCNICO</span>
                <button onclick="clearConsole()" class="text-[9px] text-slate-500 hover:text-white uppercase font-bold">Limpiar</button>
            </div>
            <div id="console-output" class="flex-1 overflow-y-auto p-2 no-scrollbar">
                <!-- Logs en tiempo real -->
            </div>
        </aside>
    </div>

    <footer class="h-[40px] bg-slate-950 border-t border-white/5 flex items-center px-6 justify-between text-[10px] font-bold text-slate-500">
        <div>TOTAL EN DB: <span id="stat-total" class="text-white">0</span></div>
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-1.5"><div class="w-2 h-2 bg-blue-500 rounded-full"></div> HTTPS</div>
            <div class="flex items-center gap-1.5"><div class="w-2 h-2 bg-green-500 rounded-full"></div> SEÑAL</div>
            <div class="flex items-center gap-1.5"><div class="w-2 h-2 bg-red-500 rounded-full"></div> ERROR</div>
        </div>
    </footer>

    <script>
        const DB = [
            ["01-OS-AZU-EXT-SN-ESTACIONAMIENTO", "10.200.8.73", "B8A44F726BB3", "AXIS P1448-LE"],
            ["02-OS-AZU-INT-PB-CONEXIÓN", "10.200.8.101", "B8A44F5B99C2", "AXIS M3065-V"],
            ["03-OS-AZU-INT-PB-SITE", "10.200.8.75", "B8A44F5B990A", "AXIS M3065-V"],
            ["04-OS-AZU-INT-PB-DIRECTORES", "10.200.8.77", "B8A44F5B99F4", "AXIS M3065-V"],
            ["05-OS-AZU-INT-PB-CENTRO", "10.200.8.71", "B8A44F5B9A43", "AXIS M3065-V"],
            ["06-OS-AZU-INT-PB-PRIVADO", "10.200.8.76", "B8A44F5B98FF", "AXIS M3065-V"],
            ["07-OS-AZU-INT-PB-ACCESO PRINCIPAL", "10.200.8.74", "B8A44F5B9D7E", "AXIS M3065-V"],
            ["08-OS-AZU-INT-PB-PASILLO AZU/EXP", "10.200.8.127", "ACCC8EEF991D", "AXIS M3045-V"],
            ["09-OS-AZU-INT-PB-IDF-17", "10.200.8.35", "B8A44F5B9865", "AXIS M3065-V"],
            ["10-OS-AZU-INT-PB-SITE FONDO", "10.200.8.125", "ACCC8EEF8BAA", "AXIS M3045-V"],
            ["11-OS-AZU-INT-PB-LIBRERO", "10.200.8.142", "B8A44F5B9901", "AXIS M3065-V"],
            ["12-OS-AZU-INT-PA-OTE", "10.200.8.70", "B8A44F5B9A92", "AXIS M3065-V"],
            ["13-OS-AZU-INT-PA-PTE", "10.200.8.72", "B8A44F5B98F8", "AXIS M3065-V"],
            ["14-OS-AZU-INT-PA-PASILLO", "10.200.8.15", "ACCC8E28BB8A", "AXIS M3005"],
            ["15-OS-AZU-INT-PA-SEOF", "10.200.8.13", "ACCC8E28B5E6", "AXIS M3005"],
            ["16-OS-MOR-EXT-PB-ESTACIONAMIENTO", "10.200.8.99", "ACCC8EEC0A95", "AXIS P1447-LE"],
            ["17-OS-MOR-INT-PROTECCIÓN PATRIMONIAL SUR", "10.200.8.163", "B8A44F10DEC2", "AXIS M3065-V"],
            ["18-OS-MOR-INT-PB-PROTECCIÓN PATRIMONIAL NTE", "10.200.8.68", "ACCC8E9B19E0", "AXIS M3045-V"],
            ["19-OS-MOR-INT-PB-ENTRADA PP", "10.200.8.85", "ACCC8EEB2440C0", "AXIS M3045-V"],
            ["20-OS-MOR-EXT-PB-PUERTA EMERGENCIA", "10.200.8.162", "B8A44F1B06FE", "AXIS M3065-V"]
        ];

        let activeIdx = -1;
        let currentIp = "";

        function log(msg, type = 'info') {
            const out = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString('es-MX', { hour12: false });
            const line = document.createElement('div');
            line.className = `console-line log-${type}`;
            line.innerHTML = `<span class="opacity-40">[${time}]</span> ${msg}`;
            out.appendChild(line);
            out.scrollTop = out.scrollHeight;
        }

        function clearConsole() { document.getElementById('console-output').innerHTML = ''; }

        function renderList() {
            const query = document.getElementById('search-input').value.toUpperCase();
            const container = document.getElementById('list-container');
            container.innerHTML = '';

            DB.forEach((cam, idx) => {
                const [name, ip] = cam;
                if (name.includes(query) || ip.includes(query)) {
                    const div = document.createElement('div');
                    div.className = `cam-item ${idx === activeIdx ? 'active' : ''}`;
                    div.onclick = () => selectCam(idx);
                    
                    div.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="w-1.5 h-1.5 rounded-full ${ip ? 'bg-blue-500 shadow-[0_0_5px_#3b82f6]' : 'bg-amber-500'}"></div>
                            <div class="flex-1 min-w-0">
                                <div class="text-[10px] font-black uppercase truncate text-slate-200">${name}</div>
                                <div class="text-[8px] font-mono text-slate-500">${ip || 'FALTA IP'}</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                }
            });
            document.getElementById('stat-total').textContent = DB.length;
        }

        function selectCam(idx) {
            activeIdx = idx;
            const [name, ip, mac, model] = DB[idx];
            currentIp = ip;
            
            log(`----------------------------------`);
            log(`INSPECCIONANDO: ${name}`);
            
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('active-monitor').classList.remove('hidden');
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('ssl-warning').classList.add('hidden');
            document.getElementById('btn-fix-ssl').classList.add('hidden');

            document.getElementById('view-name').textContent = name;
            document.getElementById('view-ip').textContent = `https://${ip}`;
            document.getElementById('view-model').textContent = model;

            const stream = document.getElementById('main-stream');
            
            if (!ip) {
                log(`FALLO: Sin dirección IP.`, 'error');
                handleError();
                return;
            }

            log(`Protocolo requerido: HTTPS (Puerto 443)`);
            log(`Destino: ${ip}`);

            // Intentar cargar stream mediante HTTPS
            const streamUrl = `https://admin:Segos.24@${ip}/axis-cgi/mjpg/video.cgi?resolution=1280x720&fps=15`;
            
            stream.onload = () => {
                log(`ÉXITO: Transmisión segura establecida.`, 'success');
                document.getElementById('loader').classList.add('hidden');
            };

            stream.onerror = () => {
                log(`FALLO DE SEGURIDAD SSL: El navegador bloqueó la conexión a ${ip}`, 'error');
                log(`CAUSA: Certificado auto-firmado o no aceptado por el sistema.`, 'warn');
                log(`SOLUCIÓN: Use el botón 'Autorizar Certificado' para aceptar el riesgo manualmente.`, 'info');
                
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('ssl-warning').classList.remove('hidden');
                document.getElementById('btn-fix-ssl').classList.remove('hidden');
                stream.src = "";
            };

            stream.src = streamUrl;
            renderList();
        }

        function openCertTab() {
            if (!currentIp) return;
            log(`Abriendo consola Axis en pestaña nueva para autorización SSL...`);
            window.open(`https://${currentIp}`, '_blank');
        }

        function handleError() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('main-stream').src = "";
        }

        window.onload = () => {
            log(`Consola de Diagnóstico Iniciada.`);
            log(`Monitoreo HTTPS Activo.`);
            renderList();
        };
    </script>
</body>
</html>