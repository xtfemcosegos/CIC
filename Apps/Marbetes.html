<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Marbetes - CIC6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Paleta Green Vibrant Metal */
            --brand-green-dark: #064e3b;
            --brand-green-mid: #059669;
            --brand-green-light: #10b981;
            --bg-main: #f0fdf4;
            --row-height: 54px;
        }

        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-main);
            color: #1e293b;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER FIJO --- */
        .header-card {
            position: relative;
            width: 100%;
            height: 52px;
            background: linear-gradient(135deg, var(--brand-green-dark) 0%, var(--brand-green-mid) 50%, var(--brand-green-light) 100%);
            display: flex;
            align-items: center;
            padding: 0 24px;
            color: white;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .header-card::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle, rgba(255,255,255,0.03) 0.5px, transparent 0.5px);
            background-size: 4px 4px;
            opacity: 0.5;
            pointer-events: none;
        }

        /* --- TOOL RIBBON --- */
        .tool-ribbon {
            width: 100%;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            z-index: 90;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }

        .kpi-row {
            display: flex;
            padding: 10px 24px;
            gap: 12px;
            overflow-x: auto;
            border-bottom: 1px solid #f1f5f9;
        }

        .kpi-chip {
            padding: 8px 16px;
            border-radius: 12px;
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }
        .kpi-chip:hover { border-color: var(--brand-green-mid); background: white; transform: translateY(-1px); }
        .kpi-chip.active { background: var(--brand-green-mid); color: white; border-color: var(--brand-green-mid); box-shadow: 0 4px 12px rgba(5, 150, 105, 0.2); }
        
        .kpi-val { font-weight: 800; font-size: 14px; }
        .kpi-lab { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; }

        .action-row {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-refresh-tool {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--brand-green-mid);
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .btn-refresh-tool:hover { background: var(--brand-green-mid); color: white; border-color: var(--brand-green-mid); }
        .btn-refresh-tool.syncing svg { animation: spin 1s linear infinite; }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .search-container {
            flex: 1;
            position: relative;
            min-width: 280px;
        }
        .search-input {
            width: 100%;
            height: 40px;
            background: #f1f5f9;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 0 16px 0 44px;
            font-size: 13px;
            font-weight: 700;
            color: #334155;
            outline: none;
            transition: all 0.2s;
        }
        .search-input:focus { background: white; border-color: var(--brand-green-mid); }

        .date-filters {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f8fafc;
            padding: 4px 8px;
            border-radius: 14px;
            border: 1px solid #e2e8f0;
        }

        .input-date {
            background: transparent;
            border: none;
            font-size: 11px;
            font-weight: 800;
            color: #475569;
            outline: none;
            cursor: pointer;
        }

        .date-type-select {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 800;
            padding: 4px 8px;
            text-transform: uppercase;
            color: var(--brand-green-dark);
            outline: none;
        }

        .btn-clear-date {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            color: #94a3b8;
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-clear-date:hover { background: #fee2e2; color: #ef4444; }

        /* --- VIRTUAL TABLE --- */
        .table-header-row {
            background: #f8fafc;
            display: flex;
            border-bottom: 2px solid #f1f5f9;
            flex-shrink: 0;
            z-index: 20;
        }

        .header-cell {
            padding: 14px 20px;
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            color: #64748b;
            letter-spacing: 0.1em;
        }

        .table-viewport {
            flex: 1;
            overflow-y: auto;
            position: relative;
            background: white;
        }

        .data-row {
            position: absolute;
            width: 100%;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background 0.15s;
        }
        .data-row:hover { background: #f0fdf4; }

        .cell-content {
            padding: 0 20px;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- SYNC NOTIFICATION --- */
        #sync-status-toast {
            position: fixed;
            bottom: 60px;
            right: 24px;
            background: #1e293b;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 500;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .pulse-dot {
            width: 8px; height: 8px; background: #10b981; border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(0.9); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(0.9); opacity: 1; } }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Estilo para el resaltado de búsqueda */
        mark.search-highlight {
            background-color: #fef08a; /* Amarillo suave Tailwind 200 */
            color: #1e293b;
            padding: 0 2px;
            border-radius: 2px;
            font-weight: 800;
            box-shadow: 0 0 0 1px #fde047;
        }
    </style>
</head>
<body class="no-scrollbar">

    <header class="header-card">
        <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            <h1 class="text-[12px] font-black uppercase tracking-tighter text-white">Gestión de Marbetes</h1>
        </div>
        <div class="flex-1"></div>
        <div class="text-[10px] font-bold text-white/60 uppercase tracking-widest">Inventario CIC 6.2</div>
    </header>

    <div class="tool-ribbon">
        <!-- KPI Ribbon -->
        <div class="kpi-row no-scrollbar">
            <div onclick="setKpiFilter('Todos')" id="kpi-all" class="kpi-chip active">
                <span id="count-all" class="kpi-val">0</span>
                <span class="kpi-lab">Total</span>
            </div>
            <div onclick="setKpiFilter('Sin folio')" id="kpi-nofolio" class="kpi-chip">
                <span id="count-nofolio" class="kpi-val">0</span>
                <span class="kpi-lab">Sin Folio</span>
            </div>
            <div onclick="setKpiFilter('Pendiente')" id="kpi-pendiente" class="kpi-chip">
                <span id="count-pending" class="kpi-val">0</span>
                <span class="kpi-lab">Pendientes</span>
            </div>
            <div onclick="setKpiFilter('Entregado')" id="kpi-entregado" class="kpi-chip">
                <span id="count-delivered" class="kpi-val">0</span>
                <span class="kpi-lab">Entregados</span>
            </div>
            <div onclick="setKpiFilter('Baja')" id="kpi-baja" class="kpi-chip">
                <span id="count-bajas" class="kpi-val">0</span>
                <span class="kpi-lab">Bajas</span>
            </div>
        </div>

        <!-- Filtros y Acciones -->
        <div class="action-row">
            <button id="btn-sync" onclick="fetchData()" class="btn-refresh-tool" title="Sincronizar Datos">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
            </button>

            <div class="search-container">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                <input type="text" id="search-input" class="search-input uppercase" placeholder="BUSCAR POR NOMBRE, SOCIO, FOLIO, PLACAS..." oninput="applyFilters()">
            </div>

            <div class="date-filters">
                <select id="date-type" class="date-type-select" onchange="applyFilters()">
                    <option value="Fecha de solicitud">Solicitud</option>
                    <option value="Fecha de asignación">Asignación</option>
                </select>
                <input type="date" id="date-start" class="input-date" onchange="applyFilters()">
                <span class="text-slate-300 font-bold">/</span>
                <input type="date" id="date-end" class="input-date" onchange="applyFilters()">
                <div class="btn-clear-date" onclick="clearDates()" title="Limpiar fechas">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Encabezado de tabla (Separado para evitar solapamiento) -->
    <div class="table-header-row">
        <div class="header-cell" style="width: 10%;">Folio</div>
        <div class="header-cell" style="width: 30%;">Titular / Nombre</div>
        <div class="header-cell" style="width: 30%;">Vehículo / Socio</div>
        <div class="header-cell" style="width: 15%;">Fecha Filtro</div>
        <div class="header-cell" style="width: 15%;">Teléfono</div>
    </div>

    <div id="viewport" class="table-viewport no-scrollbar">
        <div id="v-spacer" style="width: 100%; pointer-events: none;"></div>
        <div id="v-content" style="position: absolute; top: 0; left: 0; width: 100%;">
            <!-- Filas virtuales -->
        </div>
    </div>

    <div class="px-6 py-3 bg-slate-50 border-t flex justify-between items-center flex-shrink-0">
        <div class="flex items-center gap-4">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">CIC-6 Virtual Admin v9.9</span>
            <span id="sync-time" class="text-[9px] font-bold text-slate-300 uppercase tracking-widest">Listo</span>
        </div>
        <div id="sync-status-toast">
            <div class="pulse-dot"></div>
            <span>Sincronizando Base de Datos...</span>
        </div>
    </div>

    <script type="module">
        const API_URL = "https://default3b2cbccb81bb44a2a19a2386bb3606.02.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/fe7a46f4aa314e7a993bc66528b0d03b/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=mTepaYfQc_U2RF4I-tX0PNhrniM2OgcErzU9gDtA0fw";
        const DB_NAME = "MarbetesDB";
        const STORE_NAME = "registros";
        const ROW_HEIGHT = 54;

        let allData = [];
        let filteredData = [];
        let currentKpiFilter = "Todos";
        let isSyncing = false;

        const viewport = document.getElementById('viewport');
        const vSpacer = document.getElementById('v-spacer');
        const vContent = document.getElementById('v-content');
        const toast = document.getElementById('sync-status-toast');
        const syncTimeLabel = document.getElementById('sync-time');

        // --- HELPER: NORMALIZACIÓN DE TEXTO ---
        const normalizeText = (str) => {
            return String(str || "").toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .trim();
        };

        // --- HELPER: RESALTADO DE COINCIDENCIAS ---
        const highlightText = (text, queryParts) => {
            if (!queryParts || queryParts.length === 0 || !text) return text;
            let result = String(text);
            
            // Creamos un patrón que busque cualquiera de las partes de la consulta
            // Escapamos caracteres especiales de regex para seguridad
            const pattern = queryParts.map(p => p.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
            if (!pattern) return text;

            const regex = new RegExp(`(${pattern})`, 'gi');
            return result.replace(regex, '<mark class="search-highlight">$1</mark>');
        };

        // --- HELPER: MEDIANOCHE LOCAL PARA FECHAS ---
        function getLocalMidnight(dateStr) {
            if(!dateStr) return null;
            const [y, m, d] = dateStr.split('-').map(Number);
            return new Date(y, m - 1, d, 0, 0, 0, 0);
        }

        // --- HELPER: PARSE DE FECHAS SEGURO (SIN DESFASE UTC) ---
        function parseExcelDate(val) {
            if (!val) return null;
            let d;
            
            if (typeof val === 'number' || (!isNaN(val) && !isNaN(parseFloat(val)) && !String(val).includes('/'))) {
                const num = parseFloat(val);
                d = new Date(1899, 11, 30);
                d.setDate(d.getDate() + Math.floor(num));
            } 
            else if (typeof val === 'string' && val.includes('/')) {
                const parts = val.split('/');
                if (parts.length === 3) {
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1;
                    const year = parseInt(parts[2], 10);
                    d = new Date(year, month, day);
                }
            }
            else {
                d = new Date(val);
            }

            if (!d || isNaN(d.getTime())) return null;
            d.setHours(0, 0, 0, 0);
            return d;
        }

        // --- INDEXED DB ---
        function openDB() {
            return new Promise(res => {
                const req = indexedDB.open(DB_NAME, 1);
                req.onupgradeneeded = e => { if(!e.target.result.objectStoreNames.contains(STORE_NAME)) e.target.result.createObjectStore(STORE_NAME); };
                req.onsuccess = e => res(e.target.result);
            });
        }

        async function saveCache(data) {
            const db = await openDB();
            const tx = db.transaction([STORE_NAME], "readwrite");
            tx.objectStore(STORE_NAME).put(data, "main_cache");
        }

        async function loadCache() {
            const db = await openDB();
            return new Promise(res => {
                const req = db.transaction([STORE_NAME], "readonly").objectStore(STORE_NAME).get("main_cache");
                req.onsuccess = () => res(req.result || null);
            });
        }

        window.onload = async () => {
            const cached = await loadCache();
            if (cached) {
                allData = cached;
                updateKPIs();
                applyFilters();
                syncTimeLabel.innerText = `Memoria Activa`;
            }
            fetchData();
        };

        async function fetchData() {
            if (isSyncing) return;
            isSyncing = true;
            toast.style.display = 'flex';
            const btn = document.getElementById('btn-sync');
            if(btn) btn.classList.add('syncing');

            try {
                const res = await fetch(API_URL, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ fetchAll: true }) 
                });
                
                if (!res.ok) throw new Error("Servidor no responde");
                
                const data = await res.json();
                let fetchedRows = Array.isArray(data) ? data : (data.value || data.result || []);
                
                if (fetchedRows.length > 0) {
                    fetchedRows = fetchedRows.map(row => {
                        const dateFields = ["Fecha de solicitud", "Fecha de asignación"];
                        dateFields.forEach(field => {
                            if (row[field]) {
                                const dObj = parseExcelDate(row[field]);
                                if (dObj) {
                                    const dd = String(dObj.getDate()).padStart(2, '0');
                                    const mm = String(dObj.getMonth() + 1).padStart(2, '0');
                                    const yyyy = dObj.getFullYear();
                                    row[field] = `${dd}/${mm}/${yyyy}`;
                                }
                            }
                        });
                        return row;
                    });

                    allData = fetchedRows.sort((a, b) => {
                        const priority = { "sin folio": 1, "pendiente": 2, "entregado": 3, "baja": 4 };
                        const sA = normalizeText(a.Estatus || a.Estado);
                        const sB = normalizeText(b.Estatus || b.Estado);
                        return (priority[sA] || 99) - (priority[sB] || 99);
                    });
                    
                    await saveCache(allData);
                    updateKPIs();
                    applyFilters();
                    syncTimeLabel.innerText = `Sincronizado: ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                }
            } catch (err) { 
                console.error(err); 
            } finally { 
                isSyncing = false;
                toast.style.display = 'none';
                if(btn) btn.classList.remove('syncing');
            }
        }

        function updateKPIs() {
            document.getElementById('count-all').innerText = allData.length;
            document.getElementById('count-nofolio').innerText = allData.filter(d => normalizeText(d.Estatus || d.Estado) === 'sin folio').length;
            document.getElementById('count-pending').innerText = allData.filter(d => normalizeText(d.Estatus || d.Estado) === 'pendiente').length;
            document.getElementById('count-delivered').innerText = allData.filter(d => normalizeText(d.Estatus || d.Estado) === 'entregado').length;
            document.getElementById('count-bajas').innerText = allData.filter(d => normalizeText(d.Estatus || d.Estado) === 'baja').length;
        }

        window.setKpiFilter = (status) => {
            currentKpiFilter = status;
            document.querySelectorAll('.kpi-chip').forEach(c => c.classList.remove('active'));
            const map = { "Todos": "kpi-all", "Sin folio": "kpi-nofolio", "Pendiente": "kpi-pendiente", "Entregado": "kpi-entregado", "Baja": "kpi-baja" };
            document.getElementById(map[status])?.classList.add('active');
            applyFilters();
        };

        window.clearDates = () => {
            document.getElementById('date-start').value = "";
            document.getElementById('date-end').value = "";
            applyFilters();
        };

        // --- LÓGICA DE FILTRADO ---
        window.applyFilters = () => {
            const queryRaw = document.getElementById('search-input').value;
            const queryNorm = normalizeText(queryRaw);
            const queryParts = queryNorm.split(/\s+/).filter(p => p.length > 0);
            
            const dateType = document.getElementById('date-type').value;
            const startVal = document.getElementById('date-start').value;
            const endVal = document.getElementById('date-end').value;
            
            const startLimit = getLocalMidnight(startVal);
            const endLimit = getLocalMidnight(endVal);

            filteredData = allData.filter(item => {
                const itemStatus = normalizeText(item.Estatus || item.Estado);
                const matchesKPI = (currentKpiFilter === "Todos") || (itemStatus === normalizeText(currentKpiFilter));
                if (!matchesKPI) return false;

                if (startLimit || endLimit) {
                    const rawDate = item[dateType];
                    const d = parseExcelDate(rawDate);
                    if (!d) return false;
                    if (startLimit && !endLimit && d < startLimit) return false;
                    if (!startLimit && endLimit && d > endLimit) return false;
                    if (startLimit && endLimit && (d < startLimit || d > endLimit)) return false;
                }

                if (queryParts.length === 0) return true;
                
                const searchHaystack = normalizeText([
                    item.Folio,
                    item.Nombre,
                    item.Titular,
                    item.Placas,
                    item.Marca,
                    item.Modelo,
                    item.Socio,
                    item["No de socio"],
                    item["No. de Socio"]
                ].join(' '));

                return queryParts.every(part => searchHaystack.includes(part));
            });

            viewport.scrollTop = 0;
            vSpacer.style.height = `${filteredData.length * ROW_HEIGHT}px`;
            renderVirtual();
        };

        function renderVirtual() {
            const scrollTop = viewport.scrollTop;
            const viewportHeight = viewport.clientHeight;
            let startIdx = Math.floor(scrollTop / ROW_HEIGHT);
            let endIdx = Math.min(startIdx + Math.ceil(viewportHeight / ROW_HEIGHT) + 5, filteredData.length);
            startIdx = Math.max(0, startIdx - 2);

            vContent.style.transform = `translateY(${startIdx * ROW_HEIGHT}px)`;
            
            const dateType = document.getElementById('date-type').value;
            const slice = filteredData.slice(startIdx, endIdx);
            
            // Obtenemos las partes de la búsqueda para el resaltado
            const queryRaw = document.getElementById('search-input').value;
            const queryParts = normalizeText(queryRaw).split(/\s+/).filter(p => p.length > 0);
            
            vContent.innerHTML = slice.map((item, idx) => {
                // Preparamos los valores para mostrar y resaltar
                const folioText = highlightText(item.Folio || 'S/F', queryParts);
                const nombreItemRaw = String(item.Nombre || item.Titular || 'SIN NOMBRE').toUpperCase();
                const nombreItem = highlightText(nombreItemRaw, queryParts);
                
                const vehiculoRaw = `${item.Marca || item.Vehículo || ''} ${item.Modelo || ''}`.trim();
                const vehiculo = highlightText(vehiculoRaw, queryParts);
                
                const placasRaw = item.Placas ? `[${item.Placas}]` : '';
                const placas = highlightText(placasRaw, queryParts);
                
                const socioNumRaw = String(item["No de socio"] || item.Socio || item["No. de Socio"] || '---');
                const socioNum = highlightText(socioNumRaw, queryParts);
                
                const telefonoRaw = String(item.Teléfono || item["Teléfono"] || '---');
                const telefono = highlightText(telefonoRaw, queryParts);
                
                const fechaFiltro = item[dateType] || '---';
                
                return `
                    <div class="data-row" style="height: ${ROW_HEIGHT}px; top: ${idx * ROW_HEIGHT}px;" onclick="handleItemClick(${startIdx + idx})">
                        <div class="cell-content font-mono font-black text-emerald-800" style="width: 10%;">${folioText}</div>
                        <div class="cell-content font-bold text-slate-800" style="width: 30%;">${nombreItem}</div>
                        <div class="cell-content text-slate-500 italic" style="width: 30%;">
                            ${vehiculo} 
                            <span class="text-[10px] font-bold text-emerald-600 ml-1">${placas}</span>
                            <span class="not-italic font-black text-slate-300 ml-2">S:${socioNum}</span>
                        </div>
                        <div class="cell-content text-[11px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded" style="width: 15%; text-align: center;">${fechaFiltro}</div>
                        <div class="cell-content font-mono text-slate-400 font-bold" style="width: 15%;">${telefono}</div>
                    </div>
                `;
            }).join('');
        }

        window.handleItemClick = (index) => {
            const item = filteredData[index];
            if (!item) return;
            window.parent.postMessage({ type: 'OPEN_MARBETE_DETAIL', data: item }, '*');
        };

        viewport.onscroll = renderVirtual;
        window.addEventListener('resize', renderVirtual);
    </script>
</body>
</html>